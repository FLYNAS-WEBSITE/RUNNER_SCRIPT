name: Test1

on:
  schedule:
    - cron: '*/10 0-23 * * *'
    - cron: '*/20 0-23 * * *'
    - cron: '*/35 0-23 * * *'

jobs:
  runtests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Cache Maven dependencies
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: 17

      - name: Install Firefox and GeckoDriver
        run: |
          sudo apt-get update
          sudo apt-get install -y firefox
          wget https://github.com/mozilla/geckodriver/releases/download/v0.34.0/geckodriver-v0.34.0-linux64.tar.gz
          tar -xvzf geckodriver-v0.34.0-linux64.tar.gz
          chmod +x geckodriver
          sudo mv geckodriver /usr/local/bin/

      - name: Set up Maven
        run: sudo apt-get install -y maven

      - name: Add logging.properties
        run: |
          echo "org.openqa.selenium.level = OFF" > logging.properties
          echo "org.openqa.selenium.remote.level = OFF" >> logging.properties

      - name: Run tests with suppressed logs
        env:
          MOZ_HEADLESS: 1
          BROWSER_LOGFILE: /dev/null  # Suppresses GeckoDriver logs
        run: |
          for i in {1..3}; do
            echo "Attempt $i"
            mvn test -Djava.util.logging.config.file=logging.properties && break
            if [ $i -lt 3 ]; then
              echo "Test failed. Retrying..."
              sleep 10
            else
              echo "Test failed after $i attempts."
              exit 1
            fi
          done
